# webp-realizer
Serve autogenerated WebP images instead of jpeg/png to browsers that supports WebP

The goal of this mini-project is to create a setup that automatically generates and serves a file "image.jpg.webp" by converting "image.jpg" - unless "image.jpg.webp" already exists. The project is very similar to [Webp on demand](https://github.com/rosell-dk/webp-on-demand), and the converter can be taken from there.

With this solution, you will be able to write ie:
```
<picture>
  <source srcset="image.jpg.webp" type="image/webp" />
  <img src="image.jpg" />
</picture>
```
- and have "image.jpg.webp" automatically generated for you.

Pros and cons compared to [Webp on demand](https://github.com/rosell-dk/webp-on-demand):

PRO: This works better with CDN's<br>
CON: This does not work on images referenced in CSS<br>
CON: You will have to have control of the markup

I'm planning to make a Wordpress adaptation, which automatically creates the markup.

One solution is to work on entire output with output buffering. But the downside of doing that is that it slows things down, because content isn't allowed to be sent to the browser as its ready, but instead has to wait for the full document to be rendered (more about the approach [here](https://stackoverflow.com/questions/772510/wordpress-filter-to-modify-final-html-output)). 

Another solution is to find relevants hook. get_image_tag looks very promising (but I don't know if plugins that inserts images generally uses the hook. If not, then there will be additional work getting it to work with selected popular plugins, such as galleries)

A javascript based solution seems out of the question, because in order to work with the DOM, one must wait for the DOMContentLoaded event. But by the time that event triggers, the browser has already started loading images (only tested in one browser, but I believe it is standard now-a-days)
